# Router-Lab实验报告

本学期的网原大实验非常友好，实验文档清晰，验收标准明确。在较快地完成了实验之后，我在408帮助同学配置环境和调试代码，积累了较多的经验，现撷取一二如下。

- OJ测试相对偏弱，虽然减轻了前期工作量，但后期还需要填补前期挖下的坑，主要问题如下：
  - `checksum`计算没有按标准实现，计算前置零，计算后没有将原校验和恢复，导致转发出现问题；
  - `lookup`没有分清插入/删除是精确匹配、查询是最长前缀匹配，实现有问题；
  - `protocol`的`disassemble`函数中，最常见的问题是`mask`的大小端序，除了最后一个大规模路由表项的测试，前期其他检查都无法检出；以及存储`metric`的端序问题，OJ中要求使用大端序，在后面使用时需要时刻留意（我后面直接改成了小端存储）；还有一个我自己的愚蠢错误，迭代变量`i`使用了`uint8`类型，导致rip包长度较大时溢出发生错误；
- `main`函数部分实现关键还是要按照标准，开始写时对一些概念还不是很熟悉，遇到了一些问题：
  - 直连路由初始的`metric`应该是1而不是0，否则会被接收方丢掉；
  - 超时发包时的地址是组播地址，开始时不了解组播的概念，在这个地方卡住；
  - 水平分割没有实现或者实现有问题，这个比较常见；
  - 要发送的表项超过25个的情况，跳出循环后有可能此时所有路由表项都已发送，此时不应该再发送一个`numEntries`为0的包；
  - 有些同学抓包在链路层报错，这可能是因为发送IP包的时候报文长度参数有问题，这个错误在缺乏经验的情况下不太容易发现；
  - 收到`response`包后需要把路由信息更新/添加到路由表中，此时的下一跳`nexthop`应该是rip包的源IP地址`src_addr`；
  - 大小端序还是最容易被忽略的地方；
- 环境配置相关问题
  - 谨记助教教诲——多用git；
  - ssh命令行环境下抓包使用termshark体验不错，感谢助教推荐；
  - 路由表压力测试中遇到有BIRD启动但路由表配置不上的情况，这时大多是因为`wlan0`网卡没有`UP`，需要为其连接一个无线网络；
  - 使用Windows作为PC测试`ping`命令时需要关闭Windows防火墙；